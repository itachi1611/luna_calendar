name: Localizely Download üåç

# ======================================================
# üîÅ Reusable workflow
# - Can be called from any workflow in this repo
# ======================================================
on:
  workflow_call:
    inputs:
      output-path:
        description: 'Directory where ARB files will be downloaded'
        required: false
        default: 'lib/l10n'
        type: string
    secrets:
      LOCALIZELY_API_KEY:
        required: true

jobs:
  download:
    name: Download translations
    runs-on: ubuntu-latest

    steps:
      # ==================================================
      # üì• SOURCE CODE
      # - Required so Localizely can write into repo paths
      # ==================================================
      - name: Checkout repository
        uses: actions/checkout@v4

      # ==================================================
      # üì• Install Go
      # - Required so Localizely can write into repo paths
      # ==================================================
      - name: Install Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'

      # --------------------------------------------------
      # üì¶ Install Localizely CLI
      # --------------------------------------------------
      - name: Install Localizely CLI
        run: |
          git clone https://github.com/localizely/localizely-cli.git localizely-cli
          cd localizely-cli
          go mod download
          go build -o localizely-cli
          sudo mv localizely-cli /usr/local/bin/

      # --------------------------------------------------
      # üì¶ Install Localizely CLI
      # --------------------------------------------------
      - name: Verify Localizely CLI
        run: localizely-cli --version

      # ==================================================
      # üåç LOCALIZATION (Localizely)
      # - Requires GitHub Secret: LOCALIZELY_API_KEY
      # - Output directory: lib/l10n/*.arb
      # ==================================================
      - name: Download translations from Localizely
        run: |
          localizely-cli pull \
            --api-token ${{ secrets.LOCALIZELY_API_KEY }} \
            --format flutter_arb \
            --path ${{ inputs.output-path }}

      # ==================================================
      # üì§ ARTIFACT
      # - Share localization files with downstream jobs
      # ==================================================
      - name: Upload localization artifact
        uses: actions/upload-artifact@v4
        with:
          name: localization
          path: ${{ inputs.output-path }}
